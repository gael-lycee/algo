<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Visionneuse de fichiers</title>
  <style>
    body { font-family: monospace; background: #1e1e1e; color: #d4d4d4; padding: 20px; }
    h1, h2 { color: #4fc3f7; }
    pre { background: #252526; padding: 15px; border-radius: 8px; overflow-x: auto; }
    a { color: #4fc3f7; }
  </style>

  <!-- Prism.js pour coloration syntaxique -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

  <!-- Plugin Line Numbers -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
</head>
<body>
  <h1>Visionneuse de fichiers</h1>
  <div id="content">Chargement...</div>

  <script>
    async function loadFile() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("n"); // ex: ?n=1

      if (!id) {
        document.getElementById("content").innerText = "Veuillez indiquer un ID avec ?n=...";
        return;
      }

      try {
        // Charger la liste des fichiers
        const res = await fetch("scripts.json");
        const data = await res.json();

        if (!(id in data)) {
          document.getElementById("content").innerText = "Fichier introuvable pour l’ID " + id;
          return;
        }

        const fileName = data[id];

        // Affichage selon le type de fichier
        if (fileName.endsWith(".pdf")) {
          document.getElementById("content").innerHTML = `
            <h2>${fileName}</h2>
            <embed src="${fileName}" type="application/pdf" width="100%" height="600px" />
          `;
        } else if (fileName.endsWith(".py")) {
          // Fichier Python avec coloration + numéros de lignes
          const fileRes = await fetch(fileName);
          const code = await fileRes.text();
          document.getElementById("content").innerHTML = `
            <h2>${fileName}</h2>
            <pre class="line-numbers"><code class="language-python">${Prism.highlight(code, Prism.languages.python, 'python')}</code></pre>
          `;
        } else {
          // Tous les autres fichiers
          const fileRes = await fetch(fileName);
          const code = await fileRes.text();
          document.getElementById("content").innerHTML = `
            <h2>${fileName}</h2>
            <pre class="line-numbers"><code>${code}</code></pre>
          `;
        }
      } catch (err) {
        document.getElementById("content").innerText = "Erreur de chargement : " + err;
      }
    }

    loadFile();
  </script>
</body>
</html>
